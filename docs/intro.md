# Introduction to Land Explorer

Land Explorer is a web app with 4 repositories of code:

* A static monopage site
* A React app
* A typescript back-end server
* A typescript property-boundaries-service server

And 3 sources of data:

* The Land Explorer MySQL database
* The Property Boundaries MySQL database, containing property boundary and ownership information
* Mapbox Studio

First we'll describe the codebases and then the data sources.

## Static Site

The static site was initially generated by some kind of wordpress template, we don't know which one and we don't want to know. A few years ago, the html output was downloaded from its host and then edited directly to make changes.
We're hoping to leave it behind at some point in the future. For now the job is to make small changes as and when is needed. Any requests for big changes should be rejected in favour of starting from scratch.

### Things to know

* There is a function in a `<script></script>` at the bottom of index.html that adjusts the app link based on where the static site is being looked at from. So if you change the domain of the app, or the staging domain, or add another testing domain, for the link to work this needs to be adjusted.

## React App

The react app was generated by create-react-app, several years ago. We're in the process of rewriting it from class-based to functional components. It heavily relies on a react-mapboxgl library for the mapping features.

### Things to know

* There are Nav components and Map components, they communicate using redux.
* We get tilesets from Mapbox Studio that we reference in components/map/MapLayers
* Our base tileset uses ordnance survey data

### Editing the Styles

The styles are not currently arranged as we'd like. We recommend using the `search codebase for text` feature of your IDE to find where the styles are defined.

### How we use Redux

We use actions and reducers to centralise the requests for data from the front-end to the back-end. IF you want to make an API request, add it to one of the actions, importing the RequestActions, or create a new action file.

## Hapi.js Back-end

We use a framework called Hapi.js in the back-end. We use typescript. 

We have 2 databases. 1 for LX users and LX generated data like markers, polygons etc. 1 for property boundaries from the Land Registry.

### Things to know

* We have started using Behaviour Driven Development, so we're writing tests for behaviour before writing code.

## Property Boundaries Service

See more info about this [here](https://github.com/DigitalCommons/property-boundaries-service/blob/development/docs/intro.md).

## Deployment

We deploy to a Hetzner server. The server is currently procured and configured manually. We use apache to direct requests to the hapi.js node server and to the front-end files.

## Things We Do Sometimes

On this project, we like our data in GeoJSON form. However, sometimes it isn't provided like that, and it's then we need to use some GIS tools to change it.

Currently we use ogr2ogr, which comes as a package of tools designed to manipulate geographical data. Installing these tools can be annoying, so I use QGIS to install it for me. This is a graphical GIS manipulation that installs ogr2ogr along with a lot of other stuff.

This is an example of the command you're working towards getting to run. We're running it in the directory with the files in that we want to transform.
`ogr2ogr -f GeoJSON -skipfailures scotland_and_wales.geojson scotland_and_wales_region.shp -t_srs "EPSG:4326"`

`scotland_and_wales.geojson` is the output file. `scotland_and_wales_region.sh`p is the input file and `EPSG:4326` is one of the most common projections in latitude-longitude format, also used for GPS, based on the WGS84 standard. Note that Mapbox uses a different projection, "Web Mercator" or `EPSG:3857`, so this may lead to slight innaccuracies in the shapes of lines between coordinates when visualised on the map. There isn't really an easy way to solve this, since we are trying to visualise the surface of a 3D ellipsoid on a 2D surface.

## Land Explorer Database

We use a MySQL instance installed on the server as the main database for land explorer. This database stores user accounts and information like data groups and map permissions.

We use a library called sequelise-cli to manage migrations and seeding. These commands are stored in the land-explorer-back-end codebase in the package.json. Looking in the migration and seeding files is often where test data can be found.

## Mapbox Studio

Mapbox Studio contains custom tilesets that we use to host most of the common Land Data, for example the historic flooding and agricultural soil types. The login details are in the digital commons bitwarden account.